<div class="animate-fadeIn space-y-6">
    <div class="bg-slate-900/50 p-6 rounded-[32px] border border-slate-800 shadow-2xl backdrop-blur-sm">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-black text-white flex items-center gap-3">
                <div class="w-2 h-8 bg-emerald-500 rounded-full"></div>
                WORK REPORTS <span class="text-emerald-500/50 font-light text-lg uppercase tracking-widest hidden md:inline">Calendar</span>
            </h2>
            
            <div class="flex items-center gap-4 bg-slate-800/50 p-1.5 rounded-2xl border border-slate-700/50">
                <button onclick="window.changeWorkMonth(-1)" class="p-2 hover:bg-slate-700 rounded-xl transition-all active:scale-90 text-slate-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <div id="full_work_month" class="text-sm font-black text-white px-2 min-w-[140px] text-center tracking-tighter"></div>
                <button onclick="window.changeWorkMonth(1)" class="p-2 hover:bg-slate-700 rounded-xl transition-all active:scale-90 text-slate-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7" /></svg>
                </button>
            </div>
        </div>

        <div class="overflow-x-auto rounded-2xl border border-slate-800 shadow-inner bg-slate-950/20">
            <table class="w-full table-fixed border-collapse min-w-[700px]">
                <thead>
                    <tr class="text-slate-500 text-[11px] font-black uppercase tracking-widest bg-slate-800/30">
                        <th class="py-4 border-b border-slate-800 text-red-400/80 font-black">Sun</th>
                        <th class="py-4 border-b border-slate-800">Mon</th>
                        <th class="py-4 border-b border-slate-800">Tue</th>
                        <th class="py-4 border-b border-slate-800">Wed</th>
                        <th class="py-4 border-b border-slate-800">Thu</th>
                        <th class="py-4 border-b border-slate-800">Fri</th>
                        <th class="py-4 border-b border-slate-800 text-blue-400/80">Sat</th>
                    </tr>
                </thead>
                <tbody id="full_work_calendar_body"></tbody>
            </table>
        </div>
    </div>
</div>

<style>
    #full_work_calendar_body td { 
        height: 140px; 
        border: 1px solid rgba(30, 41, 59, 0.5); 
        vertical-align: top; 
        padding: 8px;
        transition: background-color 0.2s;
    }
    #full_work_calendar_body td:hover {
        background-color: rgba(30, 41, 59, 0.2);
    }
    .work-item {
        font-size: 10px;
        font-weight: 800;
        padding: 4px 6px;
        border-radius: 8px;
        margin-bottom: 3px;
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
    }
    .work-item:hover { 
        filter: brightness(1.2); 
        transform: translateY(-1px) scale(1.02);
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .work-item:active { transform: scale(0.98); }
</style>

<script>
    (function() {
        let viewDate = new Date();
        const db = firebase.database();

        // [Ï∂îÍ∞Ä] ÌÜµÌï© Ï†ÄÏû• Ìï®Ïàò (ÏÉÅÌÉú, ÎÇ¥Ïö©, Î©îÎ™® Î™®Îëê ÏóÖÎç∞Ïù¥Ìä∏)
        window.updateAdminReport = function(date, name) {
            const newContent = document.getElementById('editContentInput').value;
            const newStatus = document.getElementById('editStatusSelect').value;
            const newMemo = document.getElementById('adminMemoInput').value;

            if(!confirm(`${name}ÎãòÏùò Î¶¨Ìè¨Ìä∏ ÎÇ¥Ïö©ÏùÑ ÏàòÏ†ïÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) return;

            db.ref(`reports/${date}/${name}`).update({
                content: newContent,
                status: newStatus,
                adminMemo: newMemo,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                alert('Changes saved successfully!');
                if(window.closeAdminCustomModal) window.closeAdminCustomModal();
            }).catch(err => {
                console.error(err);
                alert('Update failed.');
            });
        };

        // [Ï∂îÍ∞Ä] Î¶¨Ìè¨Ìä∏ ÏÇ≠Ï†ú Ìï®Ïàò
        window.deleteAdminReport = function(date, name) {
            if(!confirm(`‚ö†Ô∏è Í≤ΩÍ≥†: ${name}ÎãòÏùò Î¶¨Ìè¨Ìä∏Î•º ÏòÅÍµ¨ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.`)) return;

            db.ref(`reports/${date}/${name}`).remove()
                .then(() => {
                    alert('Report deleted.');
                    if(window.closeAdminCustomModal) window.closeAdminCustomModal();
                })
                .catch(err => {
                    console.error(err);
                    alert('Delete failed.');
                });
        };

        // [ÏàòÏ†ï] ÌåùÏóÖÏ∞Ω ÏÉÅÏÑ∏ ÎîîÏûêÏù∏ - ÏàòÏ†ï/ÏÇ≠Ï†ú Í∏∞Îä• UI ÌÜµÌï©
        window.showWorkDetail = function(name, date, status, contentEncoded, memoEncoded) {
            const content = decodeURIComponent(contentEncoded);
            const memo = decodeURIComponent(memoEncoded || '');
            
            const titleHtml = `
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-emerald-500 to-emerald-700 flex items-center justify-center text-slate-900 font-black text-lg shadow-lg">
                        ${name.charAt(0)}
                    </div>
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">${date}</span>
                        </div>
                        <div class="text-xl font-black text-white tracking-tight">${name}'s Report</div>
                    </div>
                </div>`;

            const bodyHtml = `
                <div class="space-y-6 animate-fadeIn pb-4">
                    <div class="flex justify-between items-end gap-4">
                        <div class="flex-1">
                            <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-1 block ml-1">Current Status</label>
                            <select id="editStatusSelect" class="w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-2.5 text-xs text-white outline-none focus:border-emerald-500 transition-all">
                                <option value="In Progress" ${status === 'In Progress' ? 'selected' : ''}>üîµ IN PROGRESS</option>
                                <option value="Pending" ${status === 'Pending' ? 'selected' : ''}>üü° PENDING</option>
                                <option value="Completed" ${status === 'Completed' ? 'selected' : ''}>üü¢ COMPLETED</option>
                            </select>
                        </div>
                        <button onclick="window.deleteAdminReport('${date}', '${name}')" 
                            class="bg-red-900/20 hover:bg-red-600 text-red-500 hover:text-white px-4 py-2.5 rounded-xl border border-red-900/50 transition-all text-[10px] font-black uppercase tracking-tighter shadow-lg">
                            Delete
                        </button>
                    </div>

                    <div class="relative">
                        <div class="absolute -top-3 left-4 bg-slate-900 px-2 text-[10px] font-black text-emerald-500 tracking-widest uppercase">Report Content</div>
                        <textarea id="editContentInput" 
                            class="w-full bg-slate-950 border border-slate-700 rounded-[20px] p-5 text-sm text-slate-300 leading-relaxed min-h-[120px] outline-none focus:border-emerald-500 shadow-inner resize-none transition-all">${content}</textarea>
                    </div>

                    <div class="relative">
                        <div class="absolute -top-3 left-4 bg-slate-900 px-2 text-[10px] font-black text-blue-400 tracking-widest uppercase">Admin Management Memo</div>
                        <div class="p-4 bg-slate-950/40 rounded-[24px] border border-slate-700/50 space-y-3">
                            <textarea id="adminMemoInput" 
                                class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-xs text-white outline-none focus:border-blue-500 transition-all min-h-[80px] resize-none" 
                                placeholder="Í¥ÄÎ¶¨Ïûê Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">${memo}</textarea>
                        </div>
                    </div>

                    <button onclick="window.updateAdminReport('${date}', '${name}')" 
                        class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black text-xs py-4 rounded-2xl transition-all uppercase tracking-[0.2em] shadow-xl shadow-blue-900/20 active:scale-95">
                        Save Changes
                    </button>
                </div>`;

            if (typeof window.openAdminCustomModal === 'function') {
                window.openAdminCustomModal(titleHtml, bodyHtml);
            }
        };

        window.renderWorkFull = function() {
            const year = viewDate.getFullYear();
            const month = viewDate.getMonth();
            
            document.getElementById('full_work_month').innerText = viewDate.toLocaleString('en-US', {month:'long', year:'numeric'}).toUpperCase();

            db.ref('reports').off();
            db.ref('reports').on('value', snap => {
                const data = snap.val() || {};
                const tbody = document.getElementById('full_work_calendar_body');
                tbody.innerHTML = '';

                const firstDay = new Date(year, month, 1).getDay();
                const lastDate = new Date(year, month + 1, 0).getDate();
                
                let dateNum = 1;
                for (let i = 0; i < 6; i++) {
                    let tr = document.createElement('tr');
                    let hasCells = false;

                    for (let j = 0; j < 7; j++) {
                        let td = document.createElement('td');
                        if (i === 0 && j < firstDay || dateNum > lastDate) {
                            td.innerHTML = "";
                            td.classList.add('bg-slate-900/10');
                        } else {
                            hasCells = true;
                            const dStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(dateNum).padStart(2, '0')}`;
                            const isToday = new Date().toLocaleDateString('sv-SE') === dStr;
                            
                            let html = `<div class="flex justify-between items-center mb-2">
                                <span class="text-[11px] font-black ${isToday ? 'bg-emerald-500 text-slate-900 w-5 h-5 flex items-center justify-center rounded-full' : (j === 0 ? 'text-red-500' : (j === 6 ? 'text-blue-400' : 'text-slate-500'))}">${dateNum}</span>
                            </div>`;
                            
                            const dayReports = data[dStr] || {};
                            let reportHtml = '<div class="space-y-1.5">';
                            Object.entries(dayReports).forEach(([name, report]) => {
                                const statusColor = report.status === 'Completed' ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20' : 
                                                  (report.status === 'Pending' ? 'bg-amber-500/10 text-amber-400 border-amber-500/20' : 'bg-blue-500/10 text-blue-400 border-blue-500/20');
                                
                                const safeContent = encodeURIComponent(report.content || '');
                                const safeMemo = encodeURIComponent(report.adminMemo || '');
                                
                                reportHtml += `
                                    <div onclick="window.showWorkDetail('${name}', '${dStr}', '${report.status}', '${safeContent}', '${safeMemo}')" 
                                         class="work-item border ${statusColor}">
                                        ${name}
                                    </div>`;
                            });
                            reportHtml += '</div>';
                            
                            td.innerHTML = html + reportHtml;
                            dateNum++;
                        }
                        tr.appendChild(td);
                    }
                    if (!hasCells) break;
                    tbody.appendChild(tr);
                }
            });
        };

        window.changeWorkMonth = (offset) => {
            viewDate.setMonth(viewDate.getMonth() + offset);
            window.renderWorkFull();
        };

        window.renderWorkFull();
    })();
</script>