<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Login - Daily Report System</title>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        body { font-family: "Pretendard", sans-serif; background-color: #000000; color: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        /* 입력창 포커스 시 모바일 줌 방지를 위해 16px 유지 */
        select, input { background-color: #1e293b !important; color: white !important; border-color: #334155 !important; font-size: 16px !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.6s ease-out forwards; }
    </style>
</head>
<body class="flex flex-col justify-center items-center min-h-screen p-4 md:p-8">

    <div class="text-center mb-8 md:mb-12 animate-fadeIn w-full max-w-lg">
        <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-6">
            <img src="images/login/login.gif" alt="Logo" class="w-24 h-24 md:w-32 md:h-32 object-contain">
            <div class="text-center md:text-left">
                <h2 class="text-3xl md:text-5xl font-black text-white tracking-tighter leading-tight">
                    TDLiD<br class="hidden md:block"> Staff Login
                </h2>
                <p class="text-slate-500 text-xs md:text-sm font-medium tracking-[0.2em] uppercase mt-2">
                    Daily Report System
                </p>
            </div>
        </div>
    </div>

    <div class="bg-slate-900 p-6 md:p-10 rounded-[2.5rem] shadow-2xl w-full max-w-[440px] border border-slate-800 animate-fadeIn" style="animation-delay: 0.2s;">
        <div class="mb-8 text-center md:text-left">
            <p class="text-slate-200 text-xl md:text-2xl font-bold">Welcome back</p>
            <p class="text-slate-500 text-sm mt-1">Select your name to continue</p>
        </div>

        <div class="space-y-6">
            <div>
                <label class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 ml-1">Staff Member</label>
                <div class="relative">
                    <select id="userName" class="w-full border p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 transition appearance-none cursor-pointer shadow-xl">
                        <option value="" disabled selected>Loading staff list...</option>
                    </select>
                    <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500 text-xs">▼</div>
                </div>
            </div>
            
            <div>
                <label class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 ml-1">Password</label>
                <input type="password" id="password" class="w-full border p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 transition shadow-xl" placeholder="••••••••">
                
                <div class="flex justify-end px-1 mt-2">
                    <button onclick="findPassword()" class="text-[10px] text-slate-500 hover:text-blue-400 transition font-bold uppercase tracking-wider">
                        Forgot Password?
                    </button>
                </div>
            </div>

            <div class="pt-2">
                <button onclick="handleLogin()" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black hover:bg-blue-500 shadow-xl shadow-blue-900/30 transition-all active:scale-95 text-base uppercase tracking-widest">
                    Sign In
                </button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const firebaseConfig = { databaseURL: "https://tdlid-dailyreport-default-rtdb.firebaseio.com" };
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const userSelect = document.getElementById('userName');

            // 사용자 목록 실시간 로드
            database.ref('users').once('value', (snapshot) => {
                const users = snapshot.val();
                if (!userSelect) return;
                userSelect.innerHTML = '<option value="" disabled selected>Select Name</option>';
                if (users) {
                    const fragment = document.createDocumentFragment();
                    Object.keys(users).forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        option.textContent = name + (users[name].role === 'admin' ? ' (Manager)' : '');
                        fragment.appendChild(option);
                    });
                    userSelect.appendChild(fragment);
                }
            });

            // 로그인 로직
            window.handleLogin = function() {
                const name = document.getElementById('userName').value;
                const pw = document.getElementById('password').value;
                if(!name || !pw) return alert("Please check your credentials.");

                database.ref('users/' + name).once('value', (snapshot) => {
                    const userData = snapshot.val();
                    if (!userData) return alert("User not found.");
                    if (userData.password === pw) {
                        sessionStorage.setItem('loggedInUser', name);
                        sessionStorage.setItem('userRole', userData.role); // 역할 정보 추가 저장
                        location.href = (userData.role === 'admin' || name === 'Admin') ? "admin.html" : "staff.html";
                    } else {
                        alert("Incorrect password.");
                    }
                });
            };

            // 방법 2 응용: 패스워드 힌트 제공 로직
            window.findPassword = function() {
                const name = document.getElementById('userName').value;
                if (!name) {
                    return alert("Please select your name from the list first.");
                }

                if (confirm(`Do you want to see a password hint for '${name}'?`)) {
                    database.ref('users/' + name).once('value', (snapshot) => {
                        const userData = snapshot.val();
                        if (userData && userData.password) {
                            // 보안을 위해 앞 2글자만 노출하고 나머지는 * 처리
                            const pw = userData.password;
                            const hint = pw.length > 2 ? pw.substring(0, 2) + "*".repeat(pw.length - 2) : pw;
                            
                            alert(`[Password Hint for ${name}]\n\nHint: ${hint}\n\nIf you still cannot remember your password, please contact the System Manager.`);
                        } else {
                            alert("User information or password not found.");
                        }
                    });
                }
            };
        })();
    </script>
</body>
</html>